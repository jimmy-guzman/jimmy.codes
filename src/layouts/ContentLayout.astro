---
import BackLink from "@/components/BackLink.astro";
import LastModified from "@/components/LastModified.astro";
import MetaLine from "@/components/MetaLine.astro";
import Tags from "@/components/Tags.astro";
import { urls } from "@/configs/urls";

import "rehype-callouts/theme/github";

interface Props {
  title: string;
  tags: { tag: string; count: number }[];
  publishDate: Date;
  updatedDate?: Date;
  minutes: number;
  filePath?: string;
  relatedPosts: { slug: string; title: string }[];
}

const {
  title,
  publishDate,
  updatedDate,
  minutes,
  filePath,
  tags,
  relatedPosts,
} = Astro.props;

const emailSubject = encodeURIComponent(`Feedback on "${title}"`);
---

<section>
  <p class="text-sm text-muted">
    <MetaLine publishDate={publishDate} minutes={minutes} />
  </p>
</section>

<div class="divider" aria-hidden="true" role="presentation"></div>

<section>
  <article>
    <slot />
  </article>
</section>

<section class="mt-8">
  <Tags tags={tags} />
</section>

{
  relatedPosts.length > 0 && (
    <aside class="mt-8" aria-labelledby="related-heading">
      <h2 id="related-heading">Related Posts</h2>
      <ul>
        {relatedPosts.map((post) => (
          <li>
            <a href={`/blog/${post.slug}`}>{post.title}</a>
          </li>
        ))}
      </ul>
    </aside>
  )
}

<section class="mt-8" aria-labelledby="discuss-heading">
  <h2 id="discuss-heading">Questions or Feedback?</h2>
  <p>I'd love to hear your thoughts, questions, or feedback about this post.</p>
  <p>
    Reach me via <a href={`${urls.email}?subject=${emailSubject}`}>email</a>
    or <a href={urls.LinkedIn} target="_blank" rel="noopener noreferrer"
      >LinkedIn</a
    >.
  </p>
</section>

<a
  href="#"
  class="btn fixed right-6 bottom-6 btn-circle shadow-lg btn-ghost btn-primary"
  aria-label="Back to top"
>
  <span class="icon-[lucide--arrow-up] h-4 w-4" aria-hidden="true"></span>
</a>

{
  updatedDate && (
    <section class="mt-8 flex justify-end text-sm text-muted">
      <LastModified updatedDate={updatedDate} filePath={filePath} />
    </section>
  )
}

<section class="mt-8">
  <p>
    <BackLink url="/blog" title="Blog" />
  </p>
</section>
